<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Holy Legend - ÂÜíÈö™‰∏≠</title>
    <link rel="stylesheet" href="/holylegend/styles/game.css">
    <link rel="stylesheet" href="/holylegend/styles/tower.css"> <!-- Êñ∞Â¢ûÊà∞È¨•Â∞àÁî®Ê®£Âºè -->
    <link rel="stylesheet" href="/holylegend/styles/team.css"> <!-- Êñ∞Â¢ûÊà∞È¨•Â∞àÁî®Ê®£Âºè -->
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
</head>
<body>
    <audio id="bg-music-source" src="/holylegend/audio/game_lobby.ogg" loop></audio>

    <div class="mobile-container">
        <!-- ========================================== -->
        <!--  ÂçÄÂ°ä A: ÈÅäÊà≤Â§ßÂª≥ (Lobby)                  -->
        <!-- ========================================== -->
        <div id="lobby-layer">
            <!-- ÈÄôÊòØ‰Ω†ÂéüÊú¨ÁöÑ Header -->
            <header class="player-status-panel">
                <div class="avatar-container">
                    <div class="avatar-frame">
                        <!-- EJS ËÆäÊï∏Ê≥®ÂÖ•ÁØÑ‰æã -->
                        <img id="lobbyAvatar" src="/holylegend/images/classes/<%= user.role %>_1.png" class="pixel-art">
                    </div>
                    <div class="level-badge"><span id="lobbyLevel"><%= user.level %></span></div>
                </div>
                <div class="stats-container">
                    <div class="player-name"><%= user.nickname %></div>
                    
                    <!-- HP Ë°ÄÊ¢ù -->
                    <div class="stat-bar-row">
                        <span class="label" style="color: #e74c3c;">HP</span>
                        <div class="bar-bg">
                            <!-- EJS Ë®àÁÆóÂØ¨Â∫¶: (Áï∂Ââç/ÊúÄÂ§ß) * 100 -->
                            <div class="bar-fill hp-fill" id="lobbyHpBar" style="width: <%= (user.hp / user.maxHp) * 100 %>%;"></div>
                            <!-- Êï∏ÂÄºÁñäÂä†Âú®‰∏≠Èñì -->
                            <span class="bar-text" id="lobbyHpText"><%= user.hp %>/<%= user.maxHp %></span>
                        </div>
                    </div>

                    <!-- MP È≠îÂäõÊ¢ù -->
                    <div class="stat-bar-row">
                        <span class="label" style="color: #3498db;">MP</span>
                        <div class="bar-bg">
                            <div class="bar-fill mp-fill" id="lobbyMpBar" style="width: <%= (user.mp / user.maxMp) * 100 %>%;"></div>
                            <span class="bar-text" id="lobbyMpText"><%= user.mp %>/<%= user.maxMp %></span>
                        </div>
                    </div>

                    <!-- Á∂ìÈ©óÊ¢ù -->
                    <div class="stat-bar-row">
                        <span class="label" style="color: #3cff27;">EXP</span>
                        <div class="bar-bg">
                            <!-- EJS Ë®àÁÆóÂØ¨Â∫¶: (Áï∂Ââç/ÊúÄÂ§ß) * 100 -->
                            <div class="bar-fill exp-fill" id="lobbyEXPBar" style="width: <%= (user.exp / user.needEXP) * 100 %>%;"></div>
                            <!-- Êï∏ÂÄºÁñäÂä†Âú®‰∏≠Èñì -->
                            <span class="bar-text" id="lobbyEXPText"><%= user.exp %>/<%= user.needEXP %></span>
                        </div>
                    </div>
                </div>
            </header>

            <main class="main-actions">
                <!-- ÈªûÊìäÈÄ≤ÂÖ•Áà¨Â°î -->
                <div class="action-card tower-card" id="btn-enter-tower">
                    <div class="card-content">
                        <h2>Áà¨Â°î</h2>
                        <p>MAIN TOWER</p>
                        <div class="icon pixel-art">üè∞</div>
                    </div>
                </div>
                <div class="action-card tavern-card" id="btn-open-team">
                    <div class="card-content">
                        <h2>ÈÖíÈ§®</h2>
                        <p>TAVERN</p>
                        <div class="icon pixel-art">üç∫</div>
                    </div>
                </div>
                <!-- ÂÖ∂‰ªñÊåâÈàï... -->
                <div class="action-card guild-card" onclick="alert('ÂÖ¨ÊúÉÊãõÂãü‰∏≠')">
                    <div class="card-content">
                        <h2>ÂÖ¨ÊúÉ</h2><div class="icon pixel-art">üõ°Ô∏è</div>
                    </div>
                </div>
            </main>

            <!-- Â∫ïÈÉ®ÈÅ∏ÂñÆ -->
            <footer class="bottom-menu">
                <button class="menu-btn"><span class="icon">‚öîÔ∏è</span>ËÅ∑Ê•≠</button>
                <button class="menu-btn"><span class="icon">üìú</span>ÊäÄËÉΩ</button>
                <button class="menu-btn"><span class="icon">‚öôÔ∏è</span>ÈÅ∏ÂñÆ</button>

            </footer>
        </div>

        <!-- ========================================== -->
        <!--  ÂçÄÂ°ä B: Áà¨Â°îÊà∞È¨• (Tower Interface)         -->
        <!--  È†êË®≠Èö±Ëóè (hidden)                         -->
        <!-- ========================================== -->
        <div id="tower-layer" class="hidden">
            <!-- ========================================== -->
            <!--  ÂçÄÂ°ä F: Â§ö‰∫∫Ê∫ñÂÇôÁ¢∫Ë™ç (Ready Check)         -->
            <!--  È†êË®≠Èö±Ëóè                                   -->
            <!-- ========================================== -->
            <div id="ready-check-layer" class="hidden">
                <div class="ready-title">Èöä‰ºçÊ∫ñÂÇôÁ¢∫Ë™ç</div>
                <div class="ready-subtitle">Á≠âÂæÖÂÖ®Âì°Êé•Âèó...</div>

                <div id="ready-slots-container">
                    <!-- JS ÂãïÊÖãÁîüÊàê 4 ÂÄãÊ†ºÂ≠ê -->
                    <!-- ÁØÑ‰æã:
                    <div class="ready-slot accepted">
                        <img src="..." class="slot-avatar">
                        <div class="slot-status">‚úî</div>
                        <div class="slot-name">Player1</div>
                    </div>
                    -->
                </div>

                <div class="ready-actions">
                    <button id="btn-ready-accept" class="btn-pixel-medium btn-accept">Êé•Âèó</button>
                    <button id="btn-ready-decline" class="btn-pixel-medium btn-decline">ÊãíÁµï</button>
                </div>
            </div>
            
            <!-- 1. È†ÇÈÉ®Ë≥áË®äÂàó (Top Info) -->
            <div class="tower-header">
                <div class="tower-info">
                    <div class="info-item">FLOOR: <span id="tower-floor">1</span></div>
                    <div class="info-item text-gold">GOLD: <span id="tower-gold">0</span></div>
                </div>
            </div>

            <!-- 2. ‰∏≠Â§ÆËàûÂè∞ (Main Stage) -->
            <div class="tower-stage">
                <!-- ÊÄ™Áâ©ÊàñÂØ∂ÁÆ±È°ØÁ§∫ÂçÄ -->
                <div class="enemy-container">
                    <div class="damage-text" id="damage-popup"></div> <!-- ÂÇ∑ÂÆ≥Ë∑≥Â≠ó -->
                    <img id="enemy-img" src="/holylegend/images/enemies/slime.png" class="pixel-art enemy-anim">
                    <div class="enemy-hp-bar">
                        <div class="enemy-hp-fill" id="enemy-hp-fill" style="width: 100%;"></div>
                    </div>
                </div>
            </div>

            <!-- „ÄêÊñ∞Â¢û„ÄëÈöäÂèãÁãÄÊÖãÂàó (Teammates HUD) -->
            <div id="teammates-container">
                <!-- JS ÂãïÊÖãÁîüÊàê -->
                <!-- ÁØÑ‰æãÁµêÊßã:
                <div class="tm-card" data-id="socket_id">
                    <div class="tm-avatar-box">
                        <img src="...">
                    </div>
                    <div class="tm-info">
                        <div class="tm-name">ÈöäÂèãA</div>
                        <div class="tm-bar-group">
                            <div class="tm-hp-bar"><div class="fill" style="width:80%"></div></div>
                            <div class="tm-mp-bar"><div class="fill" style="width:50%"></div></div>
                        </div>
                    </div>
                </div>
                -->
            </div>

            <!-- 3. Áé©ÂÆ∂ÁãÄÊÖã (Player Status) -->
            <div class="tower-player-status">
                <div class="status-row">
                    <span class="label">HP</span>
                    <div class="bar-frame">
                        <div class="bar-fill hp-fill" id="battle-hp-bar" style="width: 100%;"></div>
                        <span class="bar-num" id="battle-hp-text">100/100</span>
                    </div>
                </div>
                <div class="status-row">
                    <span class="label">MP</span>
                    <div class="bar-frame">
                        <div class="bar-fill mp-fill" id="battle-mp-bar" style="width: 100%;"></div>
                        <span class="bar-num" id="battle-mp-text">50/50</span>
                    </div>
                </div>
            </div>

            <!-- 4. Â∫ïÈÉ®Êìç‰ΩúÂçÄ (Control Panel) -->
            <div class="tower-controls">
                <!-- ÊîªÊìäÊåâÈàï -->
                <button class="control-btn btn-attack" id="btn-attack">
                    <div class="icon">üó°Ô∏è</div>
                    <span>ÊîªÊìä</span>
                </button>

                <!-- ÈÅìÂÖ∑ÊåâÈàï -->
                <button class="control-btn btn-item" id="btn-item">
                    <div class="icon">üéí</div>
                    <span>ÈÅìÂÖ∑</span>
                </button>

                <!-- ÊäÄËÉΩ/Êü•ÁúãÊåâÈàï -->
                <button class="control-btn btn-skill" id="btn-skill">
                    <div class="icon">üìñ</div>
                    <span>ÊäÄËÉΩ</span>
                </button>
            </div>

            <!-- ÁçéÂãµÈÅ∏ÊìáÂçÄÂ°ä    -->
            <div id="reward-layer" class="hidden">
                <div class="reward-title">LEVEL CLEARED!</div>
                <div class="reward-subtitle">Choose a buff</div>
                
                <div id="reward-cards-container">
                </div>
            </div>

        </div>



        <!-- ========================================== -->
        <!--  ÂçÄÂ°ä C: ËÅ∑Ê•≠ÂàáÊèõ (Job Selection)           -->
        <!-- ========================================== -->
        <div id="job-layer" class="hidden">
            
            <!-- Ê®ôÈ°åÂàó -->
            <div class="layer-header">
                <h2 class="pixel-title">ËÅ∑Ê•≠‰∏ÄË¶Ω</h2>
                <button id="btn-close-job" class="btn-pixel-small">X</button>
            </div>

            <!-- ËÅ∑Ê•≠ÂàóË°®ÂÆπÂô® (ÂÖßÂÆπÁî± JS ÂãïÊÖãÁîüÊàê) -->
            <div id="job-list-container" class="scrollable-content">
                <!-- ÁØÑ‰æãÂç°ÁâáÁµêÊßã (ÂÉÖ‰æõÂèÉËÄÉÔºåJS ÊúÉË¶ÜËìãÈÄôË£°)
                <div class="job-card active">
                    <div class="job-icon-frame">
                        <img src="/holylegend/images/Warrior_1.png">
                    </div>
                    <div class="job-info">
                        <div class="job-name">WARRIOR</div>
                        <div class="job-level">Lv.5</div>
                    </div>
                    <button class="btn-pixel-small btn-select" disabled>CURRENT</button>
                </div>
                -->
                <div class="loading-text">ËºâÂÖ•‰∏≠...</div>
            </div>

        </div>



        <!-- ========================================== -->
        <!--  ÂçÄÂ°ä E: Â§ö‰∫∫ÁµÑÈöä (Team Interface)          -->
        <!-- ========================================== -->
        <div id="team-layer" class="hidden">
            
            <!-- Ê®ôÈ°åËàáÈóúÈñâÈàï -->
            <div class="layer-header">
                <h2 class="pixel-title">ÂÜíÈö™ËÄÖÈÖíÈ§®</h2>
                <button id="btn-close-team" class="btn-pixel-small">X</button>
            </div>

            <!-- Êìç‰ΩúÂçÄ (ÂâµÂª∫ / Âä†ÂÖ•) -->
            <div class="team-actions">
                <button id="btn-create-team" class="btn-pixel-large">ÂâµÂª∫Èöä‰ºç</button>
                <button id="btn-join-team" class="btn-pixel-large">Âä†ÂÖ•Èöä‰ºç</button>
            </div>

            <!-- ‰∏ªÂÖßÂÆπÂçÄ (ÂåÖÂê´Èöä‰ºçÂàóË°® & ËÅäÂ§©ÂÆ§) -->
            <div class="team-container">
                
                <!-- ‰∏äÂçäÈÉ®ÔºöÈöäÂì°ÂàóË°® -->
                <div class="section-members">
                    <div class="team-status-text">ÁõÆÂâçÈöä‰ºç (1/4)</div>
                    <div id="team-members-list">
                        
                        <!-- ÁØÑ‰æãÔºöÈöäÈï∑ -->
                        <div class="member-card">
                            <div class="member-avatar-box">
                                <img src="/holylegend/images/classes/<%=user.role %>_1.png" class="member-avatar">
                                <div class="member-lv"><%=user.level %></div>
                            </div>
                            <div class="member-stats">
                                <div class="member-name"><%=user.nickname %><span class="badge-leader">ÈöäÈï∑</span></div>
                                <div class="mini-bar-bg">
                                    <div class="mini-bar-fill hp-fill" style="width: 100%;"></div>
                                </div>
                                <div class="mini-bar-bg">
                                    <div class="mini-bar-fill mp-fill" style="width: 100%;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- ÁØÑ‰æãÔºöÁ©∫‰Ωç -->
                        <div class="member-card empty">
                            <div class="member-avatar-box empty-avatar">?</div>
                            <div class="member-stats">
                                <div class="member-name waiting">Á≠âÂæÖÂä†ÂÖ•...</div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- ‰∏ãÂçäÈÉ®ÔºöËÅäÂ§©ÂÆ§ (Êñ∞Â¢û) -->
                <div class="section-chat">
                    <div class="chat-header">Èöä‰ºçÈ†ªÈÅì</div>
                    
                    <!-- Ë®äÊÅØÈ°ØÁ§∫ÂçÄ -->
                    <div id="chat-messages" class="chat-box">
                        <div class="chat-line system">
                        </div>
                        <div class="chat-line">
                        </div>
                    </div>

                    <!-- Ëº∏ÂÖ•ÂçÄ -->
                    <div class="chat-input-area">
                        <input type="text" id="chat-input" placeholder="Ëº∏ÂÖ•Ë®äÊÅØ..." maxlength="50">
                        <button id="btn-chat-send" class="btn-pixel-small">ÈÄÅÂá∫</button>
                    </div>
                </div>

            </div>

            <!-- Â∫ïÈÉ®Ê∫ñÂÇôÊåâÈàï -->
            <div class="team-footer">
                <button id="btn-leave-team" class="btn-pixel-wide btn-danger" style="display:none;">Èõ¢ÈñãÈöä‰ºç</button>
            </div>

        </div>


        

    </div>

    <!-- ÂºïÂÖ•ÈÇèËºØËÖ≥Êú¨ -->
    <script src="/holylegend/scripts/game_core.js"></script>
    <script src="/holylegend/scripts/tower_system.js"></script>
    <script src="/holylegend/scripts/classes_system.js"></script>
    <script src="/holylegend/scripts/team_system.js"></script>
    <script src="/holylegend/scripts/game_audio.js"></script>
    <script src="/socket.io/socket.io.js"></script> <!-- Êñ∞Â¢ûÈÄôË°å -->
</body>
</html>